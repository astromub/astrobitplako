<div class="content-section" id="analytics-section">
    <h2>Advanced Analytics</h2>
    <div class="dashboard-grid">
        <div class="stat-cards">
            <div class="stat-card">
                <div class="stat-value" id="total-trades">156</div>
                <div class="stat-label">Total Trades</div>
                <div class="stat-change positive">+24 This Week</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-win">$84.50</div>
                <div class="stat-label">Average Win</div>
                <div class="stat-change positive">+$12.30</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-loss">$62.80</div>
                <div class="stat-label">Average Loss</div>
                <div class="stat-change negative">-$5.20</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="profit-factor">1.42</div>
                <div class="stat-label">Profit Factor</div>
                <div class="stat-change positive">+0.15</div>
            </div>
        </div>
        
        <div class="trading-panel">
            <h3>Performance Over Time</h3>
            <div class="chart-container">
                <canvas id="equity-chart"></canvas>
            </div>
        </div>
        
        <div class="quick-stats">
            <h3>Asset Performance</h3>
            <div class="chart-container">
                <canvas id="asset-performance-chart"></canvas>
            </div>
        </div>
        
        <div class="market-overview">
            <h3>Trade Distribution</h3>
            <div class="chart-container">
                <canvas id="trade-distribution-chart"></canvas>
            </div>
        </div>
        
        <div class="positions-panel">
            <h3>Monthly Performance</h3>
            <table class="positions-table">
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Trades</th>
                        <th>Win Rate</th>
                        <th>Profit/Loss</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>January</td>
                        <td>42</td>
                        <td class="positive">71%</td>
                        <td class="positive">+$1,240</td>
                    </tr>
                    <tr>
                        <td>February</td>
                        <td>38</td>
                        <td class="positive">68%</td>
                        <td class="positive">+$980</td>
                    </tr>
                    <tr>
                        <td>March</td>
                        <td>45</td>
                        <td class="positive">74%</td>
                        <td class="positive">+$1,520</td>
                    </tr>
                    <tr>
                        <td>April</td>
                        <td>31</td>
                        <td class="negative">52%</td>
                        <td class="negative">-$320</td>
                    </tr>
                    <tr>
                        <td>May</td>
                        <td>28</td>
                        <td class="positive">67%</td>
                        <td class="positive">+$890</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="trading-panel">
            <h3>Risk Analysis</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div>
                    <h4>Drawdown Analysis</h4>
                    <div class="stat-card" style="margin-top: 15px;">
                        <div class="stat-value">8.2%</div>
                        <div class="stat-label">Maximum Drawdown</div>
                    </div>
                    <div class="stat-card" style="margin-top: 15px;">
                        <div class="stat-value">12.4 days</div>
                        <div class="stat-label">Average Recovery Time</div>
                    </div>
                </div>
                <div>
                    <h4>Risk Metrics</h4>
                    <div class="stat-card" style="margin-top: 15px;">
                        <div class="stat-value">1.85</div>
                        <div class="stat-label">Sharpe Ratio</div>
                    </div>
                    <div class="stat-card" style="margin-top: 15px;">
                        <div class="stat-value">2.1%</div>
                        <div class="stat-label">Volatility</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Self-contained analytics functionality
(function() {
    console.log('Analytics section loaded');
    
    // Toast notification function
    const showToast = function(message, type = 'success') {
        const toast = document.createElement('div');
        toast.textContent = message;
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? '#10b981' : '#ef4444'};
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }, 3000);
    };

    // Add CSS for animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);

    // Initialize charts when section becomes visible
    const initCharts = function() {
        console.log('Initializing analytics charts...');
        
        // Equity curve chart
        const equityCtx = document.getElementById('equity-chart');
        if (equityCtx) {
            const ctx = equityCtx.getContext('2d');
            const width = equityCtx.width = equityCtx.offsetWidth;
            const height = equityCtx.height = 300;
            
            // Draw equity curve
            ctx.beginPath();
            ctx.moveTo(0, height - 50);
            ctx.lineTo(width * 0.2, height - 100);
            ctx.lineTo(width * 0.4, height - 80);
            ctx.lineTo(width * 0.6, height - 120);
            ctx.lineTo(width * 0.8, height - 60);
            ctx.lineTo(width, height - 30);
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Fill area under curve
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            ctx.fillStyle = 'rgba(16, 185, 129, 0.1)';
            ctx.fill();
        }

        // Asset performance chart
        const assetCtx = document.getElementById('asset-performance-chart');
        if (assetCtx) {
            const ctx = assetCtx.getContext('2d');
            const width = assetCtx.width = assetCtx.offsetWidth;
            const height = assetCtx.height = 300;
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            const data = [45, 25, 20, 10];
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'];
            let startAngle = 0;
            
            data.forEach((value, i) => {
                const sliceAngle = (value / 100) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[i];
                ctx.fill();
                
                startAngle += sliceAngle;
            });
        }

        // Trade distribution chart
        const tradeCtx = document.getElementById('trade-distribution-chart');
        if (tradeCtx) {
            const ctx = tradeCtx.getContext('2d');
            const width = tradeCtx.width = tradeCtx.offsetWidth;
            const height = tradeCtx.height = 300;
            const barWidth = 80;
            const spacing = 40;
            
            // Winning trades (68%)
            ctx.fillStyle = '#10b981';
            ctx.fillRect(spacing, height - 60, barWidth, -60);
            ctx.fillText('68%', spacing + barWidth/2 - 15, height - 70);
            
            // Losing trades (32%)
            ctx.fillStyle = '#ef4444';
            ctx.fillRect(spacing * 2 + barWidth, height - 28, barWidth, -28);
            ctx.fillText('32%', spacing * 2 + barWidth + barWidth/2 - 15, height - 38);
            
            // Labels
            ctx.fillStyle = '#94a3b8';
            ctx.fillText('Winning', spacing + 15, height - 20);
            ctx.fillText('Losing', spacing * 2 + barWidth + 25, height - 20);
        }
    };

    // Initialize when section is visible
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                const analyticsSection = document.getElementById('analytics-section');
                if (analyticsSection && analyticsSection.style.display !== 'none') {
                    setTimeout(initCharts, 100);
                }
            }
        });
    });

    const analyticsSection = document.getElementById('analytics-section');
    if (analyticsSection) {
        observer.observe(analyticsSection, { attributes: true });
        
        // Initial check
        if (analyticsSection.style.display !== 'none') {
            setTimeout(initCharts, 100);
        }
    }

    // Update stats with real data
    const updateStats = function() {
        // Simulate data updates
        setTimeout(() => {
            const stats = {
                totalTrades: Math.floor(Math.random() * 50) + 150,
                avgWin: (Math.random() * 20 + 80).toFixed(2),
                avgLoss: (Math.random() * 10 + 60).toFixed(2),
                profitFactor: (Math.random() * 0.5 + 1.2).toFixed(2)
            };
            
            document.getElementById('total-trades').textContent = stats.totalTrades;
            document.getElementById('avg-win').textContent = '$' + stats.avgWin;
            document.getElementById('avg-loss').textContent = '$' + stats.avgLoss;
            document.getElementById('profit-factor').textContent = stats.profitFactor;
        }, 2000);
    };

    updateStats();
})();
</script>
